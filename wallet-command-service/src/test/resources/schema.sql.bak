CREATE SCHEMA IF NOT EXISTS wallet_service;

CREATE TABLE wallet_service.wallets (
    wallet_id UUID PRIMARY KEY,
    user_id UUID NOT NULL,
    currency VARCHAR(3) NOT NULL,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL
);

CREATE TABLE wallet_service.wallet_balances (
    wallet_id UUID PRIMARY KEY,
    balance DECIMAL(19,2) NOT NULL DEFAULT 0.00,
    last_updated TIMESTAMP NOT NULL,
    last_transaction_id UUID,
    FOREIGN KEY (wallet_id) REFERENCES wallet_service.wallets(wallet_id)
);

CREATE TABLE wallet_service.transactions (
    transaction_id UUID NOT NULL,
    wallet_id UUID NOT NULL,
    type VARCHAR(20) NOT NULL,
    amount DECIMAL(19,2) NOT NULL,
    balance_after DECIMAL(19,2) NOT NULL,
    description TEXT,
    created_at TIMESTAMP NOT NULL,
    PRIMARY KEY (transaction_id, created_at),
    FOREIGN KEY (wallet_id) REFERENCES wallet_service.wallets(wallet_id)
);

CREATE TABLE wallet_service.wallet_events (
    event_id UUID PRIMARY KEY,
    aggregate_id UUID NOT NULL,
    event_type VARCHAR(50) NOT NULL,
    payload VARCHAR(1000) NOT NULL,
    created_at TIMESTAMP NOT NULL,
    FOREIGN KEY (aggregate_id) REFERENCES wallet_service.wallets(wallet_id)
);